<nav class="sidebar stack vertical gap">

    <div class="sidebar-header">

        <span class="sidebar-header-title">
            @BlazingStoryApp.Title
        </span>

        <SettingsMenu />

    </div>

    <div class="search-field">
        <input type="text" placeholder="@this.SearchBoxPlaceHolder" required autocomplete="off" @onfocus="OnFocusSearchBox" @onblur="OnBlurSearchBox" />
        <SvgIcon Type="SvgIconType.Find" Class="find-icon" />
        <KeyMap Text="/" Class="shortcut-keymap" />
    </div>

    <div class="explorer-menu">
        <NavigationTree Item="_NavigationRoot" SubHeading="true" />
    </div>

</nav>

@code {
    [CascadingParameter]
    protected StoriesStore StoriesStore { get; init; } = default!;

    [CascadingParameter]
    protected QueryRouteData RouteData { get; init; } = default!;

    private readonly NavigationTreeBuilder _NavigationTreeBuilder = new();

    private NavigationTreeItem _NavigationRoot = new();

    private bool _SearchBoxHasFocus = false;

    private string SearchBoxPlaceHolder => this._SearchBoxHasFocus ? "Type to find..." : "Find components";

    protected override void OnInitialized()
    {
        var expandedNavigationPath = this.RouteData.RouteToStoryOrDocs ? this.RouteData.Parameter : null;
        this._NavigationRoot = _NavigationTreeBuilder.Build(this.StoriesStore.StoryContainers, expandedNavigationPath);
    }

    private void OnFocusSearchBox() => _SearchBoxHasFocus = true;

    private void OnBlurSearchBox() => _SearchBoxHasFocus = false;
}
